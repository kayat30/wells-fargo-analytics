<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Wells Fargo Analytics Competition by kayat30</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Wells Fargo Analytics Competition</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/kayat30/wells-fargo-analytics" class="btn">View on GitHub</a>
      <a href="https://github.com/kayat30/wells-fargo-analytics/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/kayat30/wells-fargo-analytics/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="wells-fargo-analytics-competition" class="anchor" href="#wells-fargo-analytics-competition" aria-hidden="true"><span class="octicon octicon-link"></span></a>Wells Fargo Analytics Competition</h1>

<h2>
<a id="background" class="anchor" href="#background" aria-hidden="true"><span class="octicon octicon-link"></span></a>Background</h2>

<p>Wells Fargo challenged data scientists to extract information from social media posts mentioning banks. They provided tweets and Facebook posts that included references to four banks (BankA, BankB, BankC and BankD) in order to determine what financial and bank topics consumers posted about in social media. They were also interested in the reasons consumers post about banks and whether the substance of the posts is consistent across the industry or isolated to individual banks. Specifically, they challenged data scientists to develop an approach that identifies, classifies, and extracts the underlying drivers in social media data. </p>

<p><a href="http://innercircle.engineering.asu.edu/wp-content/uploads/2015/11/Wells-Fargo-Campus-Analytic-Challenge-Information.pdf">Competition Summary</a></p>

<h2>
<a id="approach" class="anchor" href="#approach" aria-hidden="true"><span class="octicon octicon-link"></span></a>Approach</h2>

<p>Analysis flowchart
<img src="http://i.imgur.com/Dq2crEL.png" alt=""></p>

<h3>
<a id="the-data" class="anchor" href="#the-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Data</h3>

<p>Original text file
<img src="http://i.imgur.com/erexpCj.png" alt=""></p>

<p>Content of posts
<img src="http://i.imgur.com/qprA8vl.png" alt=""></p>

<p>The first step in the analytic process was to clean/preprocess the data. </p>

<div class="highlight highlight-source-r"><pre><span class="pl-v">df</span> <span class="pl-k">=</span> read.table(<span class="pl-s"><span class="pl-pds">'</span>dataset.txt<span class="pl-pds">'</span></span>,<span class="pl-v">sep</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>|<span class="pl-pds">"</span></span>,<span class="pl-v">header</span><span class="pl-k">=</span><span class="pl-c1">T</span>)
<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-v">FullText</span> <span class="pl-k">=</span> as.character(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>)

<span class="pl-c"># Remove non-ascii characters</span>
<span class="pl-v">df.texts.clean</span> <span class="pl-k">=</span> as.data.frame(iconv(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>, <span class="pl-s"><span class="pl-pds">"</span>latin1<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>ASCII<span class="pl-pds">"</span></span>, <span class="pl-v">sub</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>))
colnames(<span class="pl-smi">df.texts.clean</span>) <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>FullText<span class="pl-pds">'</span></span>

<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-v">FullText</span> <span class="pl-k">=</span> <span class="pl-smi">df.texts.clean</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>

<span class="pl-c">#test 10,000 texts: good sample size</span>
<span class="pl-v">idx.10000</span> <span class="pl-k">=</span> sample(<span class="pl-c1">1</span><span class="pl-k">:</span>nrow(<span class="pl-smi">df</span>),<span class="pl-c1">10000</span>)
<span class="pl-v">df.10000</span> <span class="pl-k">=</span> <span class="pl-smi">df</span>[<span class="pl-smi">idx.10000</span>,]

<span class="pl-v">df.entire</span> <span class="pl-k">=</span> <span class="pl-smi">df</span>
<span class="pl-v">df</span> <span class="pl-k">=</span> <span class="pl-smi">df.10000</span>

<span class="pl-c"># Load using the tm library</span>
library(<span class="pl-smi">tm</span>) 
<span class="pl-smi">docs</span> <span class="pl-k">&lt;-</span> Corpus(DataframeSource(as.data.frame(<span class="pl-smi">df</span>[,<span class="pl-c1">6</span>])))   

<span class="pl-c">#REMEMBER: IT MATTERS THE ORDER IN WHICH TM_MAP EXPRESSIONS ARE RUN</span>
library(<span class="pl-smi">rJava</span>)
<span class="pl-smi">docs</span> <span class="pl-k">&lt;-</span> tm_map(<span class="pl-smi">docs</span>, content_transformer(<span class="pl-smi">tolower</span>)) <span class="pl-c"># convert to lowercase first</span>
<span class="pl-smi">docs</span> <span class="pl-k">&lt;-</span> tm_map(<span class="pl-smi">docs</span>, <span class="pl-smi">removeWords</span>, stopwords(<span class="pl-s"><span class="pl-pds">'</span>english<span class="pl-pds">'</span></span>))
<span class="pl-smi">docs</span> <span class="pl-k">&lt;-</span> tm_map(<span class="pl-smi">docs</span>, <span class="pl-smi">removeWords</span>, stopwords(<span class="pl-v">kind</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>SMART<span class="pl-pds">"</span></span>))
<span class="pl-c">#metaData/recurrent words</span>
<span class="pl-smi">myMeta</span> <span class="pl-k">&lt;-</span> c(<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>bank<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>banka<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>bankb<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>bankc<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>bankd<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>banke<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>internet<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>https<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>rettwit<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>twit_hndl_banka<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>twit_hndl_bankb<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>twit_hndl_bankc<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>twit_hndl_bankd<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>phone<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>dirmsg<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>dir_msg<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>street<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>name_resp<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>bankds<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>and<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>for<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>the<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>you<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>twithndlbanka<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>dirmsg<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>ret_twit<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>twit_hndl<span class="pl-pds">"</span></span>)
<span class="pl-smi">docs</span> <span class="pl-k">&lt;-</span> tm_map(<span class="pl-smi">docs</span>, <span class="pl-smi">removeWords</span>, <span class="pl-smi">myMeta</span>)
<span class="pl-smi">docs</span> <span class="pl-k">&lt;-</span> tm_map(<span class="pl-smi">docs</span>, <span class="pl-smi">stripWhitespace</span>)
<span class="pl-smi">docs</span> <span class="pl-k">&lt;-</span> tm_map(<span class="pl-smi">docs</span>, <span class="pl-smi">removePunctuation</span>)
<span class="pl-smi">docs</span> <span class="pl-k">&lt;-</span> tm_map(<span class="pl-smi">docs</span>, <span class="pl-smi">PlainTextDocument</span>)

<span class="pl-smi">new.df</span> <span class="pl-k">&lt;-</span><span class="pl-k">data.frame</span>(<span class="pl-v">text</span><span class="pl-k">=</span>unlist(sapply(<span class="pl-smi">docs</span>, `[[`, <span class="pl-s"><span class="pl-pds">"</span>content<span class="pl-pds">"</span></span>)), <span class="pl-v">stringsAsFactors</span><span class="pl-k">=</span><span class="pl-c1">FALSE</span>)</pre></div>

<h3>
<a id="frequency-analysis" class="anchor" href="#frequency-analysis" aria-hidden="true"><span class="octicon octicon-link"></span></a>Frequency Analysis</h3>

<p>After cleaning the data, analyzed frequent terms in posts to get a sense of what topics consumers most frequently posted about.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">dtm</span> <span class="pl-k">&lt;-</span> DocumentTermMatrix(<span class="pl-smi">docs</span>)
<span class="pl-v">dtm</span> <span class="pl-k">=</span> removeSparseTerms(<span class="pl-smi">dtm</span>, <span class="pl-c1">0.98</span>)
findFreqTerms(<span class="pl-smi">dtm</span>,<span class="pl-c1">200</span>)

<span class="pl-smi">freq</span> <span class="pl-k">&lt;-</span> colSums(as.matrix(<span class="pl-smi">dtm</span>))  
<span class="pl-smi">freq</span>
<span class="pl-smi">ord</span> <span class="pl-k">&lt;-</span> order(<span class="pl-smi">freq</span>)   

library(<span class="pl-smi">wordcloud</span>)
wordcloud(names(<span class="pl-smi">freq</span>), <span class="pl-smi">freq</span>, <span class="pl-v">colors</span><span class="pl-k">=</span>brewer.pal(<span class="pl-c1">8</span>, <span class="pl-s"><span class="pl-pds">"</span>Dark2<span class="pl-pds">"</span></span>))</pre></div>

<p>Word cloud of all posts
<img src="http://i.imgur.com/mOsebx5.png" alt=""></p>

<p>Also generated word clouds for each bank </p>

<div class="highlight highlight-source-r"><pre><span class="pl-v">bankA.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>BankA<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))
<span class="pl-v">bankB.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>BankB<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))
<span class="pl-v">bankC.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>BankC<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))
<span class="pl-v">bankD.idx</span> <span class="pl-k">=</span> which(sapply(<span class="pl-smi">df</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>,<span class="pl-k">function</span>(<span class="pl-smi">x</span>) grepl(<span class="pl-s"><span class="pl-pds">"</span>BankD<span class="pl-pds">"</span></span>,<span class="pl-smi">x</span>)))

<span class="pl-v">bankA.docs</span> <span class="pl-k">=</span> <span class="pl-smi">docs</span>[<span class="pl-smi">bankA.idx</span>]
<span class="pl-v">bankB.docs</span> <span class="pl-k">=</span> <span class="pl-smi">docs</span>[<span class="pl-smi">bankB.idx</span>]
<span class="pl-v">bankC.docs</span> <span class="pl-k">=</span> <span class="pl-smi">docs</span>[<span class="pl-smi">bankC.idx</span>]
<span class="pl-v">bankD.docs</span> <span class="pl-k">=</span> <span class="pl-smi">docs</span>[<span class="pl-smi">bankD.idx</span>]

<span class="pl-c">##pass these in as argument in dtm &lt;- DocumentTermMatrix(docs)</span>
<span class="pl-c">##repeat word cloud procedure </span></pre></div>

<p>Bank A
<img src="http://i.imgur.com/qyEGLEi.png" alt="">
Bank B
<img src="http://i.imgur.com/CH2lx1P.png" alt="">
Bank C
<img src="http://i.imgur.com/KwXPfas.png" alt="">
Bank D
<img src="http://i.imgur.com/qkAmlR3.png" alt=""></p>

<h3>
<a id="sentiment-analysis" class="anchor" href="#sentiment-analysis" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sentiment Analysis</h3>

<p>Analyzed sentiment of posts to identify what drives consumers to post about banks (dissatisfaction, appreciation, etc).</p>

<p>First, used function to match words in posts with list of positive and negative words</p>

<div class="highlight highlight-source-r"><pre><span class="pl-c"># Based on: http://www.ihub.co.ke/blogs/23216</span>
<span class="pl-c"># Download and upload: http://www.cs.uic.edu/~liub/FBS/opinion-lexicon-English.rar</span>
<span class="pl-c">#system('unrar e opinion-lexicon-English.rar')</span>

<span class="pl-smi">pos</span> <span class="pl-k">&lt;-</span> scan(<span class="pl-s"><span class="pl-pds">'</span>positive-words.txt<span class="pl-pds">'</span></span>,<span class="pl-v">what</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>character<span class="pl-pds">'</span></span>,<span class="pl-v">comment.char</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>;<span class="pl-pds">'</span></span>)
<span class="pl-smi">neg</span> <span class="pl-k">&lt;-</span> scan(<span class="pl-s"><span class="pl-pds">'</span>negative-words.txt<span class="pl-pds">'</span></span>,<span class="pl-v">what</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>character<span class="pl-pds">'</span></span>,<span class="pl-v">comment.char</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>;<span class="pl-pds">'</span></span>)

<span class="pl-v">score.sentiment</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">sentences</span>, <span class="pl-smi">pos.words</span>, <span class="pl-smi">neg.words</span>, <span class="pl-v">.progress</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>none<span class="pl-pds">'</span></span>)
{
  require(<span class="pl-smi">plyr</span>)
  require(<span class="pl-smi">stringr</span>)

  <span class="pl-c"># we got a vector of sentences. plyr will handle a list</span>
  <span class="pl-c"># or a vector as an "l" for us</span>
  <span class="pl-c"># we want a simple array ("a") of scores back, so we use </span>
  <span class="pl-c"># "l" + "a" + "ply" = "laply":</span>
  <span class="pl-v">scores</span> <span class="pl-k">=</span> laply(<span class="pl-smi">sentences</span>, <span class="pl-k">function</span>(<span class="pl-smi">sentence</span>, <span class="pl-smi">pos.words</span>, <span class="pl-smi">neg.words</span>) {

    <span class="pl-c"># clean up sentences with R's regex-driven global substitute, gsub():</span>
    <span class="pl-v">sentence</span> <span class="pl-k">=</span> gsub(<span class="pl-s"><span class="pl-pds">'</span>[[:punct:]]<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>, <span class="pl-smi">sentence</span>)
    <span class="pl-v">sentence</span> <span class="pl-k">=</span> gsub(<span class="pl-s"><span class="pl-pds">'</span>[[:cntrl:]]<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>, <span class="pl-smi">sentence</span>)
    <span class="pl-v">sentence</span> <span class="pl-k">=</span> gsub(<span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\\</span>d+<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>, <span class="pl-smi">sentence</span>)
    <span class="pl-c"># and convert to lower case:</span>
    <span class="pl-v">sentence</span> <span class="pl-k">=</span> tolower(<span class="pl-smi">sentence</span>)

    <span class="pl-c"># split into words. str_split is in the stringr package</span>
    <span class="pl-v">word.list</span> <span class="pl-k">=</span> str_split(<span class="pl-smi">sentence</span>, <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\\</span>s+<span class="pl-pds">'</span></span>)
    <span class="pl-c"># sometimes a list() is one level of hierarchy too much</span>
    <span class="pl-v">words</span> <span class="pl-k">=</span> unlist(<span class="pl-smi">word.list</span>)

    <span class="pl-c"># compare our words to the dictionaries of positive &amp; negative terms</span>
    <span class="pl-v">pos.matches</span> <span class="pl-k">=</span> match(<span class="pl-smi">words</span>, <span class="pl-smi">pos.words</span>)
    <span class="pl-v">neg.matches</span> <span class="pl-k">=</span> match(<span class="pl-smi">words</span>, <span class="pl-smi">neg.words</span>)

    <span class="pl-c"># match() returns the position of the matched term or NA</span>
    <span class="pl-c"># we just want a TRUE/FALSE:</span>
    <span class="pl-v">pos.matches</span> <span class="pl-k">=</span> <span class="pl-k">!</span>is.na(<span class="pl-smi">pos.matches</span>)
    <span class="pl-v">neg.matches</span> <span class="pl-k">=</span> <span class="pl-k">!</span>is.na(<span class="pl-smi">neg.matches</span>)

    <span class="pl-c"># and conveniently enough, TRUE/FALSE will be treated as 1/0 by sum():</span>
    <span class="pl-v">score</span> <span class="pl-k">=</span> sum(<span class="pl-smi">pos.matches</span>) <span class="pl-k">-</span> sum(<span class="pl-smi">neg.matches</span>)

    <span class="pl-k">return</span>(<span class="pl-smi">score</span>)
  }, <span class="pl-smi">pos.words</span>, <span class="pl-smi">neg.words</span>, <span class="pl-v">.progress</span><span class="pl-k">=</span>.<span class="pl-smi">progress</span> )

  <span class="pl-v">scores.df</span> <span class="pl-k">=</span> <span class="pl-k">data.frame</span>(<span class="pl-v">score</span><span class="pl-k">=</span><span class="pl-smi">scores</span>, <span class="pl-v">text</span><span class="pl-k">=</span><span class="pl-smi">sentences</span>)
  <span class="pl-k">return</span>(<span class="pl-smi">scores.df</span>)
}</pre></div>

<p>Then made subsets of the data based on posts mentioning each bank, names (redacted in text file to NAME), and internet addresses (redacted in text file to INTERNET)</p>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">df.1000</span><span class="pl-k">$</span><span class="pl-v">FullText</span> <span class="pl-k">=</span> as.character(<span class="pl-smi">df.1000</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>)
<span class="pl-v">df.bankA</span> <span class="pl-k">=</span> <span class="pl-smi">df.1000</span>[<span class="pl-smi">bankA.idx</span>,]
<span class="pl-v">df.bankB</span> <span class="pl-k">=</span> <span class="pl-smi">df.1000</span>[<span class="pl-smi">bankB.idx</span>,]
<span class="pl-v">df.bankC</span> <span class="pl-k">=</span> <span class="pl-smi">df.1000</span>[<span class="pl-smi">bankC.idx</span>,]
<span class="pl-v">df.bankD</span> <span class="pl-k">=</span> <span class="pl-smi">df.1000</span>[<span class="pl-smi">bankD.idx</span>,]
<span class="pl-v">df.names</span> <span class="pl-k">=</span> <span class="pl-smi">df.1000</span>[<span class="pl-smi">name.idx</span>,]
<span class="pl-v">df.internet</span> <span class="pl-k">=</span> <span class="pl-smi">df.1000</span>[<span class="pl-smi">internet.idx</span>,]</pre></div>

<p>Next, calculated sentiment score for each.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-v">df.sent</span> <span class="pl-k">=</span> <span class="pl-smi">df.BankA</span> <span class="pl-c">##or whichever subset to analyze</span>

<span class="pl-v">scores</span> <span class="pl-k">=</span> score.sentiment(<span class="pl-smi">df.sent</span><span class="pl-k">$</span><span class="pl-smi">FullText</span>, <span class="pl-smi">pos</span>, <span class="pl-smi">neg</span>, <span class="pl-v">.progress</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>text<span class="pl-pds">'</span></span>)
<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-v">very.pos</span> <span class="pl-k">=</span> as.numeric(<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-smi">score</span> <span class="pl-k">&gt;</span><span class="pl-k">=</span> <span class="pl-c1">2</span>)
<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-v">very.neg</span> <span class="pl-k">=</span> as.numeric(<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-smi">score</span> <span class="pl-k">&lt;</span><span class="pl-k">=</span> <span class="pl-k">-</span><span class="pl-c1">2</span>)

<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-v">pos</span> <span class="pl-k">=</span> as.numeric(<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-smi">score</span> <span class="pl-k">&gt;</span><span class="pl-k">=</span> <span class="pl-c1">1</span>)
<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-v">neg</span> <span class="pl-k">=</span> as.numeric(<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-smi">score</span> <span class="pl-k">&gt;</span><span class="pl-k">=</span> <span class="pl-k">-</span><span class="pl-c1">1</span>)

<span class="pl-c"># how many very positives and very negatives</span>
<span class="pl-v">numpos</span> <span class="pl-k">=</span> sum(<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-smi">very.pos</span>)
<span class="pl-v">numneg</span> <span class="pl-k">=</span> sum(<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-smi">very.neg</span>)

<span class="pl-c"># global score</span>
<span class="pl-v">global_score</span> <span class="pl-k">=</span> round( <span class="pl-c1">100</span> <span class="pl-k">*</span> <span class="pl-smi">numpos</span> <span class="pl-k">/</span> (<span class="pl-smi">numpos</span> <span class="pl-k">+</span> <span class="pl-smi">numneg</span>) )</pre></div>

<p>The global scores (a rough measure of general sentiment) are as follows:</p>

<p>All Banks (df.1000): 59</p>

<p>Bank A: 57</p>

<p>Bank B: 56</p>

<p>Bank C: 74</p>

<p>Bank D: 50</p>

<p>Text with “NAME”: 50</p>

<p>Text with “INTERNET”: 55</p>

<p>Next, plots of sentiment scores were generated, separating by media type (Twitter or Facebook). These plots can be found at the bottom of the page.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-v">mediatype</span> <span class="pl-k">=</span> <span class="pl-smi">df.sent</span><span class="pl-k">$</span><span class="pl-smi">MediaType</span>

<span class="pl-c"># colors</span>
<span class="pl-v">cols</span> <span class="pl-k">=</span> c(<span class="pl-s"><span class="pl-pds">"</span>#7CAE00<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>#00BFC4<span class="pl-pds">"</span></span>)
names(<span class="pl-smi">cols</span>) <span class="pl-k">=</span> c(<span class="pl-s"><span class="pl-pds">"</span>twitter<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>facebook<span class="pl-pds">"</span></span>)

<span class="pl-c"># boxplot</span>
library(<span class="pl-smi">ggplot2</span>)
ggplot(<span class="pl-smi">scores</span>, aes(<span class="pl-v">x</span><span class="pl-k">=</span><span class="pl-smi">mediatype</span>, <span class="pl-v">y</span><span class="pl-k">=</span><span class="pl-smi">score</span>, <span class="pl-v">group</span><span class="pl-k">=</span><span class="pl-smi">mediatype</span>)) <span class="pl-k">+</span>
  geom_boxplot(aes(<span class="pl-v">fill</span><span class="pl-k">=</span><span class="pl-smi">mediatype</span>)) <span class="pl-k">+</span>
  scale_fill_manual(<span class="pl-v">values</span><span class="pl-k">=</span><span class="pl-smi">cols</span>) <span class="pl-k">+</span>
  geom_jitter(<span class="pl-v">colour</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>gray40<span class="pl-pds">"</span></span>,<span class="pl-v">position</span><span class="pl-k">=</span>position_jitter(<span class="pl-v">width</span><span class="pl-k">=</span><span class="pl-c1">0.2</span>), <span class="pl-v">alpha</span><span class="pl-k">=</span><span class="pl-c1">0.3</span>) <span class="pl-k">+</span>
  labs(<span class="pl-v">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Media Type's Sentiment Scores: All Banks<span class="pl-pds">"</span></span>) <span class="pl-k">+</span> 
  xlab(<span class="pl-s"><span class="pl-pds">'</span>Media Type<span class="pl-pds">'</span></span>) <span class="pl-k">+</span> ylab(<span class="pl-s"><span class="pl-pds">'</span>Sentiment Score<span class="pl-pds">'</span></span>)

<span class="pl-c"># barplot of average score</span>
<span class="pl-v">meanscore</span> <span class="pl-k">=</span> tapply(<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-smi">score</span>, <span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-smi">mediatype</span>, <span class="pl-smi">mean</span>)
<span class="pl-v">df.plot</span> <span class="pl-k">=</span> <span class="pl-k">data.frame</span>(<span class="pl-v">mediatype</span><span class="pl-k">=</span>names(<span class="pl-smi">meanscore</span>), <span class="pl-v">meanscore</span><span class="pl-k">=</span><span class="pl-smi">meanscore</span>)
<span class="pl-smi">df.plot</span><span class="pl-k">$</span><span class="pl-smi">mediatypes</span> <span class="pl-k">&lt;-</span> reorder(<span class="pl-smi">df.plot</span><span class="pl-k">$</span><span class="pl-smi">mediatype</span>, <span class="pl-smi">df.plot</span><span class="pl-k">$</span><span class="pl-smi">meanscore</span>)

ggplot(<span class="pl-smi">df.plot</span>, aes(<span class="pl-v">x</span> <span class="pl-k">=</span> <span class="pl-k">factor</span>(<span class="pl-smi">mediatypes</span>), <span class="pl-v">y</span> <span class="pl-k">=</span> <span class="pl-smi">meanscore</span>, <span class="pl-v">fill</span><span class="pl-k">=</span><span class="pl-smi">mediatypes</span>)) <span class="pl-k">+</span>
  geom_bar(<span class="pl-v">stat</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>identity<span class="pl-pds">"</span></span>) <span class="pl-k">+</span>
  scale_fill_manual(<span class="pl-v">values</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[order(<span class="pl-smi">df.plot</span><span class="pl-k">$</span><span class="pl-smi">meanscore</span>)]) <span class="pl-k">+</span>
  labs(<span class="pl-v">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Average Sentiment Score: All Banks<span class="pl-pds">"</span></span>) <span class="pl-k">+</span> 
  xlab(<span class="pl-s"><span class="pl-pds">'</span>Media Type<span class="pl-pds">'</span></span>) <span class="pl-k">+</span> ylab(<span class="pl-s"><span class="pl-pds">'</span>Average Score<span class="pl-pds">'</span></span>)

<span class="pl-c"># barplot of average very positive</span>
<span class="pl-v">mediatype_pos</span> <span class="pl-k">=</span> ddply(<span class="pl-smi">scores</span>, .(<span class="pl-smi">mediatype</span>), <span class="pl-smi">summarise</span>, <span class="pl-v">mean_pos</span><span class="pl-k">=</span>mean(<span class="pl-smi">very.pos</span>))
<span class="pl-smi">mediatype_pos</span><span class="pl-k">$</span><span class="pl-smi">mediatypes</span> <span class="pl-k">&lt;-</span> reorder(<span class="pl-smi">mediatype_pos</span><span class="pl-k">$</span><span class="pl-smi">mediatype</span>, <span class="pl-smi">mediatype_pos</span><span class="pl-k">$</span><span class="pl-smi">mean_pos</span>)

ggplot(<span class="pl-smi">mediatype_pos</span>, aes(<span class="pl-v">x</span> <span class="pl-k">=</span> <span class="pl-k">factor</span>(<span class="pl-smi">mediatype</span>), <span class="pl-v">y</span> <span class="pl-k">=</span> <span class="pl-smi">mean_pos</span>, <span class="pl-v">fill</span><span class="pl-k">=</span><span class="pl-smi">mediatype</span>)) <span class="pl-k">+</span>
  geom_bar(<span class="pl-v">stat</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>identity<span class="pl-pds">"</span></span>) <span class="pl-k">+</span>
  scale_fill_manual(<span class="pl-v">values</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[order(<span class="pl-smi">df.plot</span><span class="pl-k">$</span><span class="pl-smi">meanscore</span>)]) <span class="pl-k">+</span>
  labs(<span class="pl-v">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Average Very Positive Sentiment Score: All Banks<span class="pl-pds">"</span></span>) <span class="pl-k">+</span> 
  xlab(<span class="pl-s"><span class="pl-pds">'</span>Media Type<span class="pl-pds">'</span></span>) <span class="pl-k">+</span> ylab(<span class="pl-s"><span class="pl-pds">'</span>Average Score<span class="pl-pds">'</span></span>)

<span class="pl-v">mediatype_neg</span> <span class="pl-k">=</span> ddply(<span class="pl-smi">scores</span>, .(<span class="pl-smi">mediatype</span>), <span class="pl-smi">summarise</span>, <span class="pl-v">mean_neg</span><span class="pl-k">=</span>mean(<span class="pl-smi">very.neg</span>))
<span class="pl-smi">mediatype_neg</span><span class="pl-k">$</span><span class="pl-smi">mediatypes</span> <span class="pl-k">&lt;-</span> reorder(<span class="pl-smi">mediatype_neg</span><span class="pl-k">$</span><span class="pl-smi">mediatype</span>, <span class="pl-smi">mediatype_neg</span><span class="pl-k">$</span><span class="pl-smi">mean_neg</span>)

ggplot(<span class="pl-smi">mediatype_neg</span>, aes(<span class="pl-v">x</span> <span class="pl-k">=</span> <span class="pl-k">factor</span>(<span class="pl-smi">mediatype</span>), <span class="pl-v">y</span> <span class="pl-k">=</span> <span class="pl-smi">mean_neg</span>, <span class="pl-v">fill</span><span class="pl-k">=</span><span class="pl-smi">mediatype</span>)) <span class="pl-k">+</span>
  geom_bar(<span class="pl-v">stat</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>identity<span class="pl-pds">"</span></span>) <span class="pl-k">+</span>
  scale_fill_manual(<span class="pl-v">values</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[order(<span class="pl-smi">df.plot</span><span class="pl-k">$</span><span class="pl-smi">meanscore</span>)]) <span class="pl-k">+</span>
  labs(<span class="pl-v">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Average Very Negative Sentiment Score: All Banks<span class="pl-pds">"</span></span>) <span class="pl-k">+</span> 
  xlab(<span class="pl-s"><span class="pl-pds">'</span>Media Type<span class="pl-pds">'</span></span>) <span class="pl-k">+</span> ylab(<span class="pl-s"><span class="pl-pds">'</span>Average Score<span class="pl-pds">'</span></span>)</pre></div>

<p>To obtain the context of the rest of the content of the posts with very positive and very negative scores (&gt;1 and &lt;-1 respectively), word clouds of very positive and very negative posts were generated. These word clouds can be found at the bottom of the page.</p>

<div class="highlight highlight-source-r"><pre>library(<span class="pl-smi">tm</span>)
library(<span class="pl-smi">wordcloud</span>)

<span class="pl-v">df.sent</span> <span class="pl-k">=</span> <span class="pl-smi">new.df.BankA</span>

<span class="pl-v">scores</span> <span class="pl-k">=</span> score.sentiment(<span class="pl-smi">df.sent</span><span class="pl-k">$</span><span class="pl-smi">text</span>, <span class="pl-smi">pos</span>, <span class="pl-smi">neg</span>, <span class="pl-v">.progress</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>text<span class="pl-pds">'</span></span>)

<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-v">text</span> <span class="pl-k">=</span> as.character(<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-smi">text</span>)

<span class="pl-v">posIndices</span> <span class="pl-k">=</span> which(as.numeric(<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-smi">score</span>) <span class="pl-k">&gt;</span> <span class="pl-c1">1</span>)
<span class="pl-v">negIndices</span> <span class="pl-k">=</span> which(as.numeric(<span class="pl-smi">scores</span><span class="pl-k">$</span><span class="pl-smi">score</span>) <span class="pl-k">&lt;</span> <span class="pl-k">-</span><span class="pl-c1">1</span>)

<span class="pl-v">posPosts</span> <span class="pl-k">=</span> <span class="pl-smi">scores</span>[<span class="pl-smi">posIndices</span>,<span class="pl-c1">2</span>]
<span class="pl-v">negPosts</span> <span class="pl-k">=</span> <span class="pl-smi">scores</span>[<span class="pl-smi">negIndices</span>,<span class="pl-c1">2</span>]

wordcloud(<span class="pl-smi">negPosts</span>, <span class="pl-v">scale</span> <span class="pl-k">=</span> c(<span class="pl-c1">3</span>, <span class="pl-c1">0.0</span>), <span class="pl-v">min.freq</span> <span class="pl-k">=</span> <span class="pl-c1">20</span>, <span class="pl-v">colors</span><span class="pl-k">=</span>brewer.pal(<span class="pl-c1">8</span>, <span class="pl-s"><span class="pl-pds">"</span>Dark2<span class="pl-pds">"</span></span>))</pre></div>

<h2>
<a id="conclusions" class="anchor" href="#conclusions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Conclusions</h2>

<p>Based on the graphs and word clouds (found at the bottom of the page in the Graphs section), a few insights can be made. </p>

<p>First, based on the sentiment analysis, the data shows that people are more likely to post more extreme content on Facebook rather than Twitter. The general trend in the data was that average very positive and very negative scores were much higher for Facebook than for Twitter. This finding could have implications as to how banks market themselves on each social medium.</p>

<p>Based on the word frequency analysis and sentiment-based frequency analysis, the data reveals several trends in consumer topics. In the word clouds, in which larger words are those that appear more frequently in posts, much of the content of these posts were directly related to banking ("money", "card", "center", "account", "financial", "credit" for example). 
In the sentiment-based word clouds, there was a common theme in positive clouds of content relating to banks' customer service, support, and values ("service", "free", "people", "confidence", "personal", "support", "team", "customer", "mission"). In the negative clouds, the content was also customer service (related to call centers and time), but more heavily banking services ("customer", "service", "time", "call", "money", "charges", "pay", "card", "account", "fraud", "managers", "unable"). This finding could have implications as to how banks conduct their services, especially customer service, but also ease of the banking process. </p>

<p>One very relevant takeaway would be the prevalence of dissatisfaction with call centers. This suggests that it is increasingly important for banks to properly train those employees in the highest standard of customer service. Banks should consider expanding their budgets for this sort of training since dissatisfaction can be broadcast to social platforms and tarnish the image of the bank as well as threatening the future involvement of current clientele.</p>

<h2>
<a id="graphs" class="anchor" href="#graphs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Graphs</h2>

<p><img src="http://i.imgur.com/KbZVGQg.png" alt=""> <img src="http://i.imgur.com/2A7iiGh.png" alt=""> 
<img src="http://i.imgur.com/Fe5NBmo.png" alt=""> <img src="http://i.imgur.com/iodCywR.png" alt=""></p>

<p><img src="http://i.imgur.com/HiNabnK.png" alt=""> <img src="http://i.imgur.com/iXqS4L7.png" alt=""> 
<img src="http://i.imgur.com/OOQYs6v.png" alt=""> <img src="http://i.imgur.com/7RTMJX1.png" alt=""></p>

<p><img src="http://i.imgur.com/FE9Q3FZ.png" alt=""> <img src="http://i.imgur.com/XxvUpct.png" alt="">
<img src="http://i.imgur.com/pcGglih.png" alt=""> <img src="http://i.imgur.com/7o5WC1K.png" alt=""></p>

<p><img src="http://i.imgur.com/5t8Kqrc.png" alt=""> <img src="http://i.imgur.com/Nr8EJCb.png" alt="">
<img src="http://i.imgur.com/9eJqAee.png" alt=""> <img src="http://i.imgur.com/VKApV17.png" alt=""></p>

<p><img src="http://i.imgur.com/oknPYyU.png" alt=""> <img src="http://i.imgur.com/7Y2mF7Q.png" alt="">
<img src="http://i.imgur.com/niYXz6g.png" alt=""> <img src="http://i.imgur.com/4Jrrdf5.png" alt=""></p>

<p><img src="http://i.imgur.com/4NXYVh8.png" alt=""></p>

<p><img src="http://i.imgur.com/QxAFXiy.png" alt=""></p>

<p>Bank A very positive
<img src="http://i.imgur.com/omMIvrO.png" alt=""> 
Bank A very negative
<img src="http://i.imgur.com/2BFyP4d.png" alt="">
Bank B very positive
<img src="http://i.imgur.com/2LW8p5T.png" alt=""> 
Bank B very negative
<img src="http://i.imgur.com/CU3hrzK.png" alt="">
Bank C very positive
<img src="http://i.imgur.com/s29D7Rm.png" alt=""> 
Bank C very negative
<img src="http://i.imgur.com/UBxIBmr.png" alt="">
Bank D very positive
<img src="http://i.imgur.com/FrOhnNz.png" alt=""> 
Bank D very negative
<img src="http://i.imgur.com/inonpvJ.png" alt="">
INTERNET very positive
<img src="http://i.imgur.com/PuRVS9F.png" alt="">
INTERNET very negative
<img src="http://i.imgur.com/2RziLyu.png" alt="">
NAME very positive
<img src="http://i.imgur.com/bJf3Ujw.png" alt=""> 
NAME very negative
<img src="http://i.imgur.com/3taSp6k.png" alt=""></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/kayat30/wells-fargo-analytics">Wells Fargo Analytics Competition</a> is maintained by <a href="https://github.com/kayat30">kayat30</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
